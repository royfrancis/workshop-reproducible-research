<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.549">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Working with Jupyter</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../assets/favicon.png" rel="icon" type="image/png">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<style>

      .quarto-title-block .quarto-title-banner {
        background-image: url(../assets/images/banner.webp);
background-size: cover;
      }
</style>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
<link href="https://fonts.googleapis.com/css2?family=Fira+Mono&amp;family=Nunito:ital,wght@0,400;0,500;0,600;1,400;1,500;1,600&amp;display=swap" rel="stylesheet">


</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../assets/logos/nbis-scilifelab.png" alt="logo" class="navbar-logo">
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../home_schedule.html"> 
<span class="menu-text">Schedule</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../home_contents.html"> 
<span class="menu-text">Contents</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../home_syllabus.html"> 
<span class="menu-text">Syllabus</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../home_precourse.html"> 
<span class="menu-text">Pre-course</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../home_info.html"> 
<span class="menu-text">Info</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/NBISweden/workshop-reproducible-research/"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Working with Jupyter</h1>
            <p class="subtitle lead">How to generate reproducible reports and computational notebooks</p>
                      </div>
  </div>
    
  
  <div class="quarto-title-meta">

      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">18-Oct-2024</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><span class="header-section-number">1</span> Introduction</a></li>
  <li><a href="#the-basics" id="toc-the-basics" class="nav-link" data-scroll-target="#the-basics"><span class="header-section-number">2</span> The basics</a></li>
  <li><a href="#writing-markdown" id="toc-writing-markdown" class="nav-link" data-scroll-target="#writing-markdown"><span class="header-section-number">3</span> Writing markdown</a></li>
  <li><a href="#writing-code" id="toc-writing-code" class="nav-link" data-scroll-target="#writing-code"><span class="header-section-number">4</span> Writing code</a></li>
  <li><a href="#magics" id="toc-magics" class="nav-link" data-scroll-target="#magics"><span class="header-section-number">5</span> Magics</a></li>
  <li><a href="#plotting" id="toc-plotting" class="nav-link" data-scroll-target="#plotting"><span class="header-section-number">6</span> Plotting</a></li>
  <li><a href="#other-packages-for-plotting" id="toc-other-packages-for-plotting" class="nav-link" data-scroll-target="#other-packages-for-plotting"><span class="header-section-number">7</span> Other packages for plotting</a></li>
  <li><a href="#widgets" id="toc-widgets" class="nav-link" data-scroll-target="#widgets"><span class="header-section-number">8</span> Widgets</a></li>
  <li><a href="#other-interactive-plots" id="toc-other-interactive-plots" class="nav-link" data-scroll-target="#other-interactive-plots"><span class="header-section-number">9</span> Other interactive plots</a></li>
  <li><a href="#extensions" id="toc-extensions" class="nav-link" data-scroll-target="#extensions"><span class="header-section-number">10</span> Extensions</a></li>
  <li><a href="#reproducibility" id="toc-reproducibility" class="nav-link" data-scroll-target="#reproducibility"><span class="header-section-number">11</span> Reproducibility</a></li>
  <li><a href="#version-control-of-jupyter-notebooks" id="toc-version-control-of-jupyter-notebooks" class="nav-link" data-scroll-target="#version-control-of-jupyter-notebooks"><span class="header-section-number">12</span> Version control of Jupyter notebooks</a>
  <ul>
  <li><a href="#other-tools-for-version-control-of-notebooks" id="toc-other-tools-for-version-control-of-notebooks" class="nav-link" data-scroll-target="#other-tools-for-version-control-of-notebooks"><span class="header-section-number">12.1</span> Other tools for version control of notebooks</a></li>
  </ul></li>
  <li><a href="#making-sure-notebooks-work-as-expected" id="toc-making-sure-notebooks-work-as-expected" class="nav-link" data-scroll-target="#making-sure-notebooks-work-as-expected"><span class="header-section-number">13</span> Making sure notebooks work as expected</a></li>
  <li><a href="#converting-notebooks" id="toc-converting-notebooks" class="nav-link" data-scroll-target="#converting-notebooks"><span class="header-section-number">14</span> Converting notebooks</a></li>
  <li><a href="#notebooks-and-quarto" id="toc-notebooks-and-quarto" class="nav-link" data-scroll-target="#notebooks-and-quarto"><span class="header-section-number">15</span> Notebooks and Quarto</a></li>
  <li><a href="#extra-material" id="toc-extra-material" class="nav-link" data-scroll-target="#extra-material"><span class="header-section-number">16</span> Extra material</a></li>
  <li><a href="#running-jupyter-notebooks-on-a-cluster" id="toc-running-jupyter-notebooks-on-a-cluster" class="nav-link" data-scroll-target="#running-jupyter-notebooks-on-a-cluster"><span class="header-section-number">17</span> Running Jupyter notebooks on a cluster</a></li>
  <li><a href="#using-binder-to-share-interactive-notebooks" id="toc-using-binder-to-share-interactive-notebooks" class="nav-link" data-scroll-target="#using-binder-to-share-interactive-notebooks"><span class="header-section-number">18</span> Using Binder to share interactive notebooks</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">






<section id="introduction" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="introduction"><span class="header-section-number">1</span> Introduction</h2>
<p>The Jupyter Notebook is an open-source web application that allows you to create and share documents that contain code, equations, visualizations and text. The functionality is partly overlapping with Quarto (see the <a href="quarto-1-introduction">tutorial</a>), in that they both use markdown and code chunks to generate reports that integrate results of computations with the code that generated them. Jupyter Notebook comes from the Python community while Quarto was developed by Posit (who also created R Markdown and RStudio), but you could use most common programming languages in either alternative. In practice though, it’s quite common that R developers use Jupyter but probably not very common that Python developers use RStudio. Some reasons to use Jupyter include:</p>
<ul>
<li>Python is lacking a really good IDE for doing exploratory scientific data analysis, like RStudio or Matlab. Some people use Jupyter simply as an alternative for that.</li>
<li>The Jupyter Project community is large and dynamic, and there are lots of tools for sharing, displaying or interacting with notebooks.</li>
<li>An early ambition with Jupyter notebooks (and its predecessor IPython notebooks) was to be analogous to the lab notebook used in a wet lab. It would allow the data scientist to document his or her day-to-day work and interweave results, ideas, and hypotheses with the code. From a reproducibility perspective, this is one of the main advantages.</li>
<li>Jupyter notebooks can be used, just like Quarto, to provide a tighter connection between your data and your results by integrating results of computations with the code that generated them. They can also do this in an interactive way that makes them very appealing for sharing with others.</li>
</ul>
<p>As always, the best way is to try it out yourself and decide what to use it for!</p>
<p>This tutorial depends on files from the course GitHub repo. Take a look at the <a href="pre-course-setup">setup</a> for instructions on how to set it up if you haven’t done so already. Then open up a terminal and go to <code>workshop-reproducible-research/tutorials/jupyter</code> and activate your <code>jupyter-env</code> Conda environment.</p>
<div class="callout callout-style-default callout-note callout-titled" title="A note on nomenclature">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
A note on nomenclature
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>Jupyter: a project to develop open-source software, open-standards, and services for interactive computing across dozens of programming languages. Lives at <a href="https://jupyter.org">jupyter.org</a>.</li>
<li>Jupyter Notebook: A web application that you use for creating and managing notebooks. One of the outputs of the Jupyter project.</li>
<li>Jupyter lab: A more powerful and feature-rich interface that also includes a terminal, debugger, tabs <em>etc.</em></li>
<li>Jupyter notebook: The actual <code>.ipynb</code> file that constitutes your notebook.</li>
</ul>
</div>
</div>
</section>
<section id="the-basics" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="the-basics"><span class="header-section-number">2</span> The basics</h2>
<p>One thing that sets Jupyter Notebook apart from what you might be used to is that it’s a web application, <em>i.e.</em> you edit and run your code from your browser. But first you have to start the Jupyter Notebook server. At this point you may either try the classic notebook interface by running:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ex">jupyter</span> notebook <span class="at">--allow-root</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Or give the more feature-rich Jupyter lab interface a try by running:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="ex">jupyter</span> lab <span class="at">--allow-root</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Whichever interface you choose you should see something similar to this printed to your terminal:</p>
<pre class="no-highlight"><code>[I 18:02:26.722 NotebookApp] Serving notebooks from local directory: /Users/john/workshop-reproducible-research/tutorials/jupyter
[I 18:02:26.723 NotebookApp] 0 active kernels
[I 18:02:26.723 NotebookApp] The Jupyter Notebook is running at:
[I 18:02:26.723 NotebookApp] http://localhost:8888/?token=e03f10ccb40efc3c6154358593c410a139b76acf2cae000
[I 18:02:26.723 NotebookApp] Use Control-C to stop this server and shut down all kernels (twice to skip confirmation).
[C 18:02:26.724 NotebookApp]

    Copy/paste this URL into your browser when you connect for the first time,
    to login with a token:
        http://localhost:8888/?token=e03f10ccb40efc3c6154358593c410a139b76acf2cae785c
[I 18:02:27.209 NotebookApp] Accepting one-time-token-authenticated connection from ::1</code></pre>
<div class="callout callout-style-default callout-tip callout-titled" title="A note for Windows users">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
A note for Windows users
</div>
</div>
<div class="callout-body-container callout-body">
<p>If you see the error message <code>Start : This command cannot be run due to the error: The system cannot find the file specified. ...</code> then try starting Jupyter with <code>jupyter notebook --no-browser</code> then copy the URL given into the browser directly.</p>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled" title="Jupyter notebook versions">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Jupyter notebook versions
</div>
</div>
<div class="callout-body-container callout-body">
<p>Depending on what version of the <code>notebook</code> conda package you have installed, the interface may look slightly different. The screenshots in this tutorial are from version 7, an update which has brought the ‘classic’ Jupyter notebook closer to the Jupyter lab interface. Read more about this update at the <a href="https://jupyter-notebook.readthedocs.io/en/latest/migrate_to_notebook7.html">Jupyter homepage</a>.</p>
</div>
</div>
<p>The Jupyter Notebook/Lab interface probably opened up a web browser for you automatically, otherwise go to the address specified in the message in the terminal. Note that the server is running locally (as <code>http://localhost:8888</code>) so this does not require that you have an active internet connection. Also note that it says:</p>
<pre class="no-highlight"><code>Serving notebooks from local directory: &lt;/some/local/path/workshop-reproducible-research/tutorials/jupyter&gt;</code></pre>
<p>Everything you do in your Notebook session will be stored in this directory, so you won’t lose any work if you shut down the server.</p>
<blockquote class="blockquote">
<p><img src="images/jupyter_dashboard.png" class="img-fluid" width="700"></p>
</blockquote>
<p>What you’re looking at is the Notebook dashboard. This is where you manage your files, notebooks, and kernels. The Files tab shows the files in your directory. The Running tab keeps track of all your processes.</p>
<p>The Jupyter lab dashboard should look something like this:</p>
<blockquote class="blockquote">
<p><img src="images/jupyterlab_dashboard.png" class="img-fluid" width="700"></p>
</blockquote>
<p>Let’s start by creating an empty notebook. You can do this by selecting the Files tab and clicking New &gt; Notebook. When the notebook opens, select the suggested Python 3 kernel from the drop-down menu.</p>
<p>This will open up a new tab or window looking like this:</p>
<blockquote class="blockquote">
<p><img src="images/jupyter_empty_nb.png" class="img-fluid" width="700"></p>
</blockquote>
<p>Start by giving your notebook a name by clicking on the text “Untitled” at the top of the page. Enter “jupyter-tutorial.ipynb”.</p>
<p>Note that for most of this tutorial we will describe how you work in the actual notebook and not devote a lot of time to the extra features available in the Jupyter lab interface.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>If you want to start Jupyter Notebooks on a cluster that you SSH to (<em>e.g.</em> Uppmax) see the section in the <a href="jupyter-10-extra-material">Extra material</a></p>
</div>
</div>
<p>Jupyter notebooks are made up of cells, and you are currently standing in the first cell in your notebook. Your cursor should be blinking in this cell, indicating that you are in “Edit mode” meaning that you can type text in the cell. Pressing the <code>Esc</code> key puts you in “Command mode” which allows you to manipulate the notebook as a whole, more on this later.</p>
<p>Cells in Jupyter notebooks can be of two types:<em>markdown</em> or <em>code</em>.</p>
<ul>
<li><strong>Markdown:</strong></li>
</ul>
<p>These cells contain static material such as captions, text, lists, images and so on. You express this using Markdown, which is a lightweight markup language. Markdown documents can then be converted to other formats for viewing (the document you’re reading now is written in Markdown and then converted to HTML). The format is discussed a little more in detail in the <a href="quarto-1-introduction">Quarto tutoriall</a>. Jupyter Notebook uses a dialect of Markdown called GitHub Flavoured Markdown, which is described <a href="https://guides.github.com/features/mastering-markdown/">here</a>.</p>
<ul>
<li><strong>Code:</strong></li>
</ul>
<p>These are the cells that actually do something, just as code chunks do in Quarto/R Markdown. You can write code in dozens of languages and do all kinds of clever tricks. You then run the code cell and any output the code generates, such as text or figures, will be displayed beneath the cell. We will get back to this in much more detail, but for now it’s enough to understand that code cells are for executing code that is interpreted by a kernel (in this case the Python version in your Conda environment).</p>
<p>Before we continue, here are some shortcuts that can be useful. Note that they are only applicable when in “Command mode”. Most of them are also available from the menus. You can also view this list of shortcuts from the <strong>Help</strong> menu under “Show Keyboard Shortcuts”.</p>
<table class="table">
<thead>
<tr class="header">
<th>Shortcut</th>
<th>Effect</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>enter</code></td>
<td>Enter Edit mode</td>
</tr>
<tr class="even">
<td><code>escape</code></td>
<td>Enter Command mode</td>
</tr>
<tr class="odd">
<td><code>ctrl-enter</code></td>
<td>Run the cell</td>
</tr>
<tr class="even">
<td><code>shift-enter</code></td>
<td>Run the cell and select the cell below</td>
</tr>
<tr class="odd">
<td><code>alt-enter</code></td>
<td>Run the cell and insert a new cell below</td>
</tr>
<tr class="even">
<td><code>s</code></td>
<td>Save the notebook</td>
</tr>
<tr class="odd">
<td><code>tab</code></td>
<td>For code completion or indentation</td>
</tr>
<tr class="even">
<td><code>m,y</code></td>
<td>Toggle between Markdown and Code cells</td>
</tr>
<tr class="odd">
<td><code>d-d</code></td>
<td>Delete a cell</td>
</tr>
<tr class="even">
<td><code>a</code></td>
<td>Insert cells above current cell</td>
</tr>
<tr class="odd">
<td><code>b</code></td>
<td>Insert cells below current cell</td>
</tr>
<tr class="even">
<td><code>x</code></td>
<td>Cut currently selected cells</td>
</tr>
<tr class="odd">
<td><code>v</code></td>
<td>Paste cell below</td>
</tr>
<tr class="even">
<td><code>o</code></td>
<td>Toggle output of current cell</td>
</tr>
</tbody>
</table>
</section>
<section id="writing-markdown" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="writing-markdown"><span class="header-section-number">3</span> Writing markdown</h2>
<p>Let’s use our first cell to create a header. Change the format from Code to Markdown using the drop-down list in the Notebook Toolbar, or by pressing the <code>m</code> key when in command mode. Double click on the cell, or hit <code>enter</code> to enter editing mode and input “# My notebook” (“#” is used in Markdown for header 1). Run the cell with <code>ctrl</code>-<code>enter</code> (<code>cmd</code>-<code>enter</code> on Mac).</p>
<p>Markdown is a simple way to structure your notebook into sections with descriptive notes, lists, links, images etc.</p>
<p>Below are some examples of what you can do in markdown. Paste all or parts of it into one or more cells in your notebook to see how it renders. Make sure you set the cell type to Markdown.</p>
<pre><code>## Introduction
In this notebook I will try out some of the **fantastic** concepts of Jupyter
Notebooks.

## Markdown basics
Examples of text attributes are:

- *italics*
- **bold**
- `monospace`

Sections can be separated by horizontal lines.

---

Blockquotes can be added, for instance to insert a Monty Python quote:

&gt; Spam!
&gt; Spam!
&gt; Spam!
&gt; Spam!

See [here](https://jupyter-notebook.readthedocs.io/en/stable/examples/Notebook/Working%20With%20Markdown%20Cells.html) for more information.</code></pre>
</section>
<section id="writing-code" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="writing-code"><span class="header-section-number">4</span> Writing code</h2>
<p>Now let’s write some code! Since we chose a Python kernel, Python would be the native language to run in a cell. Enter this code in the second cell and run it:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Hello world!"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Note how the output is directly displayed below the cell. This interactive way of working is one of the things that sets Jupyter Notebook apart from RStudio and Quarto. In RStudio/Quarto, documents are typically rendered top-to-bottom in one run, while you work <em>in</em> a Jupyter notebook in a different way. This requires some special attention when it comes to reproducibility, which we will get back to in the <a href="jupyter-7-reproducibility">reproducibility</a> section.</p>
<p>What <strong>is</strong> a Jupyter notebook? Let’s look a closer at the notebook we’re currently working in. Jupyter Notebooks are autosaved every minute or so, so you will already have it available. We can be a little meta and do this from within the notebook itself, by running some shell commands in a code cell. This very handy functionality is possible by prepending the command with <code>!</code>. Try adding <code>!ls</code> to a code cell and run it. This will list the files in the current directory.</p>
<p>Aha, we have a new file called <code>jupyter-tutorial.ipynb</code>! This is our notebook. Look at the first ten lines of the file by using <code>!head jupyter-tutorial.ipynb</code>. Seems like it’s just a plain old JSON file. Since it’s a text file it’s suitable for version control with for example Git. There are however some special considerations to take into account for Notebooks which we will cover in the <a href="jupyter-7-reproducibility">reproducibility section</a> of this tutorial.</p>
<p>Variables defined in cells become variables in the global namespace. You can therefore share information between cells. Try to define a function or variable in one cell and use it in the next. For example, add the following to a new cell and run it:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> print_me(<span class="bu">str</span>):</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="bu">str</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Now create a new cell and add:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>print_me(<span class="st">"Hi!"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Your notebook should now look something like this.</p>
<blockquote class="blockquote">
<p><img src="images/jupyter_basic_update.png" class="img-fluid" width="700"></p>
</blockquote>
<p>The focus of this tutorial is not on how to write Markdown or Python; you can make really pretty notebooks with Markdown and you can code whatever you want with Python. Rather, we will focus on the Jupyter Notebook features that allow you to do a little more than that.</p>
<div class="callout callout-style-default callout-note callout-titled" title="Quick recap">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Quick recap
</div>
</div>
<div class="callout-body-container callout-body">
<p>In this section we’ve learned:</p>
<ul>
<li>That a Jupyter notebook consists of a series of cells, and that they can be either markdown or code cells.</li>
<li>That we execute the code in a code cell with the kernel that we chose when opening the notebook.</li>
<li>We can run shell commands by prepending them with <code>!</code>.</li>
<li>A Jupyter notebook is simply a text file in JSON format.</li>
</ul>
</div>
</div>
</section>
<section id="magics" class="level2" data-number="5">
<h2 data-number="5" class="anchored" data-anchor-id="magics"><span class="header-section-number">5</span> Magics</h2>
<p>Magics constitute a simple command language that significantly extends the power of Jupyter notebooks. There are two types of magics:</p>
<ul>
<li><strong>Line magics</strong>: Commands that are prepended by <code>%</code>, and whose arguments only extend to the end of the line.</li>
<li><strong>Cell magics</strong>: Commands that start with <code>%%</code> and then apply to the whole cell. Must be written on the first line of a cell.</li>
</ul>
<p>Now list all available magics with <code>%lsmagic</code> (which itself is a magic). You add a question mark to a magic to show the help (<em>e.g.</em> <code>%lsmagic?</code>). Some of them act as shortcuts for commonly used shell commands (<code>%ls</code>, <code>%cp</code>, <code>%cat</code>, ..). Others are useful for debugging and optimizing your code (<code>%timeit</code>, <code>%debug</code>, <code>%prun</code>, ..). For more information see the <a href="https://ipython.readthedocs.io/en/stable/interactive/magics.html">magics documentation</a>.</p>
<p>A very useful magic, in particular when using shell commands a lot in your work, is <code>%%capture</code>. This will capture the stdout/stderr of any code cell and store them in a Python object. Run <code>%%capture?</code> to display the help and try to understand how it works. Try it out with either some Python code, other magics or shell commands. Here is an example of how you can make it work:</p>
<pre class="no-highlight"><code>%%capture output
%%bash
echo "Print to stdout"
echo "Print to stderr" &gt;&amp;2</code></pre>
<p>… And in another cell:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"stdout:"</span> <span class="op">+</span> output.stdout)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"stderr:"</span> <span class="op">+</span> output.stderr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<blockquote class="blockquote">
<p><strong>Tip</strong> <br> You can capture the output of some magics directly like this: <code>my_dir = %pwd</code>.</p>
</blockquote>
<p>The <code>%%script</code> magic is used for specifying a program (Bash, Perl, Ruby, ..) with which to run the code (similar to a shebang). For some languages it’s possible to use these shortcuts:</p>
<ul>
<li><code>%%ruby</code></li>
<li><code>%%perl</code></li>
<li><code>%%bash</code></li>
<li><code>%%html</code></li>
<li><code>%%latex</code></li>
<li><code>%%R</code></li>
</ul>
<div class="callout callout-style-default callout-note callout-titled" title="A note on R code">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
A note on R code
</div>
</div>
<div class="callout-body-container callout-body">
<p>In order to use the <code>%%R</code> magic you need to install the <code>rpy2</code> extension, for example with Conda. This package is already installed in the <code>jupyter-env</code> environment you’re using for this tutorial. However, you also have to load it by running <code>%load_ext rpy2.ipython</code> in a cell.</p>
</div>
</div>
<p>Try this out if you know any of the languages above. Otherwise you can always try to print the quadratic formula with LaTeX!</p>
<pre class="no-highlight"><code>\begin{array}{*{20}c} {x = \frac{{ - b \pm \sqrt {b^2 - 4ac} }}{{2a}}} &amp; {{\rm{when}}} &amp; {ax^2 + bx + c = 0} \\ \end{array}</code></pre>
<p>Another useful magic is <code>%precision</code> which sets the floating point precision in the notebook. As a quick example, add the following to a cell and run it:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="bu">float</span>(<span class="dv">100</span><span class="op">/</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Next set the precision to 4 decimal points by running a cell with:</p>
<pre><code>%precision 4</code></pre>
<p>Now run the cell with <code>float(100/3)</code> again to see the difference.</p>
<p>Running <code>%precision</code> without additional arguments will restore the default.</p>
<div class="callout callout-style-default callout-note callout-titled" title="Quick recap">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Quick recap
</div>
</div>
<div class="callout-body-container callout-body">
<p>In this section we’ve learned:</p>
<ul>
<li>The basics of Jupyter magics and the difference between line magics and cell magics</li>
<li>How to capture and use output from notebook cells with <code>%%capture</code></li>
<li>How to use magics to run non-Python code in notebooks</li>
</ul>
</div>
</div>
</section>
<section id="plotting" class="level2" data-number="6">
<h2 data-number="6" class="anchored" data-anchor-id="plotting"><span class="header-section-number">6</span> Plotting</h2>
<p>An essential feature of Jupyter Notebooks is of course the ability to visualize data and results via plots. A full guide to plotting in Python is beyond the scope of this course, but we’ll offer a few glimpses into the plotting landscape of Python.</p>
<p>First of all, Python has a library for plotting called <a href="https://matplotlib.org/stable/index.html">matplotlib</a>, which comes packed with functionality for creating high-quality plots. Below is an example of how to generate a line plot of a sine wave.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Import packages</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate a set of evenly spaced numbers between 0 and 100</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.linspace(<span class="dv">0</span>,<span class="dv">3</span><span class="op">*</span>np.pi,<span class="dv">100</span>)</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Use the sine function to generate y-values</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> np.sin(x)</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the data</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>line, <span class="op">=</span> plt.plot(x, y, color<span class="op">=</span><span class="st">'red'</span>, linestyle<span class="op">=</span><span class="st">"-"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>By default plots are rendered in the notebook as rasterised images which can make the quality poor. To render in scalable vector graphics format use the <code>set_matplotlib_formats</code> from the matplotlib_inline package:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib_inline</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>matplotlib_inline.backend_inline.set_matplotlib_formats(<span class="st">'pdf'</span>, <span class="st">'svg'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Now try running the code for the sine wave plot again.</p>
</section>
<section id="other-packages-for-plotting" class="level2" data-number="7">
<h2 data-number="7" class="anchored" data-anchor-id="other-packages-for-plotting"><span class="header-section-number">7</span> Other packages for plotting</h2>
<p>As we mentioned Matplotlib comes with <strong>a lot</strong> of functionality which is great because it allows you to create all sorts of plots and modify them exactly to your liking. However, this can also mean that creating very basic plots might involve a lot of cumbersome coding, when all you want is a simple bar chart!</p>
<p>Fortunately there are a number of Python packages that build upon matplotlib but with a much simplified interface. One such popular package is <a href="http://Seaborn.pydata.org/">Seaborn</a>. Below we’ll see how to generate a nice looking bar plot with error bars.</p>
<p>First import the Seaborn package (using an abbreviated name to simplify typing):</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Next we’ll load some example data of penguins collected at the Palmer Station, in Antarctica.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>penguins <span class="op">=</span> sns.load_dataset(<span class="st">"penguins"</span>)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Look at first 5 lines of the data</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>penguins.head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The most basic way to generate a bar plot of this data with Seaborn is:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>sns.barplot(data<span class="op">=</span>penguins)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Simple right? Yes, but maybe not very informative. Here Seaborn simply calculates the mean of all numeric variables for the penguins and plots them with error bars representing a 95% confidence interval.</p>
<p>Let’s say that instead we want to plot the mean value of the body mass of the penguins at the different islands where they were examined.</p>
<pre><code>sns.barplot(data=penguins, x="island", y="body_mass_g", errorbar="sd");</code></pre>
<p>Here we specified to use values in the ‘island’ column as categories for the x-axis, and values in the ‘body_mass_g’ column as values for the y-axis. The barplot function of Seaborn will then calculate the mean body mass for each island and plot the bars. With <code>errorbar="sd"</code> we tell the function to draw the standard deviation as error bars, instead of computing a confidence interval.</p>
<p>If we instead want to visualize the data as a scatterplot we can use the <code>sns.scatterplot</code> function. Let’s plot the body mass vs bill length for all penguins and colour the data points by species. We’ll also move the legend outside of the plotting area and modify the x and y-axis labels:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Store the matplotlib axes containing the plot in a variable called 'ax'</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> sns.scatterplot(data<span class="op">=</span>penguins, x<span class="op">=</span><span class="st">"bill_length_mm"</span>, y<span class="op">=</span><span class="st">"body_mass_g"</span>,</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>                     hue<span class="op">=</span><span class="st">"species"</span>)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Modify the labels of the plot</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">"Bill length (mm)"</span>)</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">"Body mass (g)"</span>)</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Set legend position outside of plot</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>ax.legend(bbox_to_anchor<span class="op">=</span>(<span class="dv">1</span>,<span class="dv">1</span>))<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>If you want to save a plot to file you can use the <code>plt.savefig</code> function. Add the following to the bottom of the cell with the scatterplot code:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="st">"scatterplot.pdf"</span>, bbox_inches<span class="op">=</span><span class="st">"tight"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The <code>bbox_inches="tight"</code> setting ensures that the figure is not clipped when saved to file.</p>
<p>The Seaborn <a href="http://Seaborn.pydata.org/">website</a> contains great tutorials and examples of other ways to plot data!</p>
<div class="callout callout-style-default callout-note callout-titled" title="Quick recap">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Quick recap
</div>
</div>
<div class="callout-body-container callout-body">
<p>In this section we’ve learned:</p>
<ul>
<li>How to generate simple plots with <code>matplotlib</code></li>
<li>How to import and use the <code>Seaborn</code> package for plotting</li>
<li>How to save plots from notebooks to a file</li>
</ul>
</div>
</div>
</section>
<section id="widgets" class="level2" data-number="8">
<h2 data-number="8" class="anchored" data-anchor-id="widgets"><span class="header-section-number">8</span> Widgets</h2>
<p>Since we’re typically running our notebooks in a web browser, they are quite well suited for also including more interactive elements. A typical use case could be that you want to communicate some results to a collaborator or to a wider audience, and that you would like them to be able to modify how the results are displayed. It could, for example, be to select which gene to plot for, or to see how some parameter value affects a clustering. Jupyter notebooks has great support for this in the form of <em>widgets</em>.</p>
<p>Widgets are eventful Python objects that have a representation in the browser, often as a control like a slider, text box, etc. These are implemented in the <code>ipywidgets</code> package.</p>
<p>The easiest way to get started with using widgets are via the <code>interact</code> and <code>interactive</code> functions. These functions auto-generate widgets from functions that you define, and then call those functions when you manipulate the widgets. This might sound abstract so let’s look at an example.</p>
<p>Let’s take the scatterplot of the penguins dataset that we generated in the previous section and add widgets that lets us choose variables to plot as well as coloring of the points.</p>
<p>First we’ll import the <code>interactive</code> function from <code>ipywidgets</code>. Let’s also import the <code>widgets</code> module which we we’ll use later. Add the following code to a cell and run it:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> ipywidgets <span class="im">import</span> interactive, widgets</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Now, in a new cell, define a function called <code>scatterplot</code> with the code to generate the plot itself. Also add a <code>palette</code> argument to the function so that we can specify the colour palette to use for the plot. The function should look like this:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> scatterplot(x, y, hue, palette):</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>    ax <span class="op">=</span> sns.scatterplot(data<span class="op">=</span>penguins, x<span class="op">=</span>x, y<span class="op">=</span>y, hue<span class="op">=</span>hue, palette<span class="op">=</span>palette)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Run the cell and create a new cell below it.</p>
<p>Next, we’ll use the <code>interactive</code> function to generate a widget to control the <code>x</code>, <code>y</code>, <code>hue</code> and <code>palette</code> arguments. The <code>interactive</code> function takes a function as its first argument, and then keyword arguments for each of the arguments in the function. The returned value is a widget which we will store in a variable called <code>interactive_scatterplot</code>. Add the following to a cell and run it:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>interactive_scatterplot <span class="op">=</span> interactive(scatterplot,</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>            x<span class="op">=</span>[<span class="st">"bill_length_mm"</span>,<span class="st">"bill_depth_mm"</span>,<span class="st">"flipper_length_mm"</span>,<span class="st">"body_mass_g"</span>],</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>            y<span class="op">=</span>[<span class="st">"body_mass_g"</span>,<span class="st">"bill_length_mm"</span>,<span class="st">"bill_depth_mm"</span>,<span class="st">"flipper_length_mm"</span>],</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>            hue<span class="op">=</span>[<span class="st">"species"</span>,<span class="st">"island"</span>,<span class="st">"sex"</span>],</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>            palette<span class="op">=</span>[<span class="st">"Set1"</span>,<span class="st">"Set2"</span>,<span class="st">"Dark2"</span>,<span class="st">"Paired2"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Importantly, all parameters defined in the <code>scatterplot</code> function must be given in the <code>interactive</code> call. The <code>interactive_scatterplot</code> widget is now tied to the <code>scatterplot</code> function. However, we still haven’t displayed the widget itself. To do that, simply add <code>interactive_scatterplot</code> to a new cell and run it:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>interactive_scatterplot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This should show the scatterplot with drop-down menus for each of the arguments. Try changing the <code>x</code> and <code>y</code> variables to plot by selecting from the respective drop-downs. The <code>hue</code> drop-down now lets you change what variable to use for colouring the points and the <code>palette</code> drop-down changes the colour palette. As you can see, the available options in the drop-downs are the ones we specified in the <code>interactive</code> call.</p>
<p>Depending on the <code>type</code> of the passed argument different types of widgets will be created by <code>interactive</code>. For instance:</p>
<ul>
<li><code>int</code> or <code>float</code> arguments will generate a slider</li>
<li><code>bool</code> arguments (True/False) will generate checkbox widgets</li>
<li><code>list</code> arguments will generate a drop-down</li>
<li><code>str</code> arguments will generate a text-box</li>
</ul>
<p>Let’s add a slider to control the size of the points. In the Seaborn package this is controlled by the <code>s</code> argument to the <code>scatterplot</code> function. Modify the cell with your <code>scatterplot</code> function so it looks like this (remember to run the cell in order to update the function definition):</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> scatterplot(x, y, hue, palette, size<span class="op">=</span><span class="dv">50</span>):</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>    ax <span class="op">=</span> sns.scatterplot(data<span class="op">=</span>penguins, x<span class="op">=</span>x, y<span class="op">=</span>y, hue<span class="op">=</span>hue, palette<span class="op">=</span>palette, s<span class="op">=</span>size)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Note that we added a <code>size</code> argument to the function and supplied it to the Seaborn scatterplot call with <code>s=size</code>. Setting <code>size=50</code> in the function definition means that the default size of the points will be 50.</p>
<p>Now we need to add a slider for the <code>size</code> argument. Update the cell where we call the <code>interactive</code> function so that it looks like this, then run it:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>interactive_scatterplot <span class="op">=</span> interactive(scatterplot,</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>            x<span class="op">=</span>[<span class="st">"bill_length_mm"</span>,<span class="st">"bill_depth_mm"</span>,<span class="st">"flipper_length_mm"</span>,<span class="st">"body_mass_g"</span>],</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>            y<span class="op">=</span>[<span class="st">"body_mass_g"</span>,<span class="st">"bill_length_mm"</span>,<span class="st">"bill_depth_mm"</span>,<span class="st">"flipper_length_mm"</span>,],</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>            hue<span class="op">=</span>[<span class="st">"species"</span>,<span class="st">"island"</span>,<span class="st">"sex"</span>],</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>            palette<span class="op">=</span>[<span class="st">"Set1"</span>,<span class="st">"Set2"</span>,<span class="st">"Dark2"</span>,<span class="st">"Paired2"</span>],</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>            size<span class="op">=</span>(<span class="dv">20</span>,<span class="dv">100</span>,<span class="dv">10</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Here the <code>size</code> argument is defined as a <a href="https://docs.python.org/3/library/stdtypes.html#tuple">tuple</a> which sets the minimum value of the slider to 20, the maximum value to 100 and the step size to 10.</p>
<p>Finally, re-run the cell where we displayed the <code>interactive_scatterplot</code> widget. You should now see a slider for the <code>size</code> argument (starting at 50). Try changing the size of the points by moving the slider.</p>
<p>This is how it should look if everything works.</p>
<p><img src="images/jupyter_widget.png" class="img-fluid" width="700"></p>
<p>There are lots of widgets, <em>e.g.</em>:</p>
<ul>
<li>Drop-down menus</li>
<li>Toggle buttons</li>
<li>Range sliders</li>
<li>File uploader</li>
</ul>
<p>… And much, much more. Here is a <a href="https://ipywidgets.readthedocs.io/en/latest/examples/Widget%20List.html">list of all available widgets</a> together with documentation and examples. Some of these widgets cannot be auto-generated by <code>interactive</code>, but fear not! Instead of relying on auto-generation we can define the widget and supply it directly to <code>interactive</code>.</p>
<p>To see this in practice, we’ll modify the scatterplot function to display a title and add a color picker widget that let’s us set the color of the title text.</p>
<p>First, update the scatterplot function so that it looks like this:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> scatterplot(x, y, hue, palette, size, color):</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>    ax <span class="op">=</span> sns.scatterplot(data<span class="op">=</span>penguins, x<span class="op">=</span>x, y<span class="op">=</span>y, hue<span class="op">=</span>hue, palette<span class="op">=</span>palette, s<span class="op">=</span>size)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>    ax.set_title(<span class="st">"Penguin scatterplot"</span>, color<span class="op">=</span>color)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Then run the cell to update the function definition.</p>
<p>Next, we’ll define the colour picker widget. Add the definition to the cell where you defined the <code>interactive_scatterplot</code> then supply the widget to the <code>interactive</code> call. The cell should look like this:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>colorpicker <span class="op">=</span> widgets.ColorPicker(</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>    concise<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>    description<span class="op">=</span><span class="st">'Title color'</span>,</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>    value<span class="op">=</span><span class="st">'blue'</span>,</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>    disabled<span class="op">=</span><span class="va">False</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>interactive_scatterplot <span class="op">=</span> interactive(scatterplot,</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>            x<span class="op">=</span>[<span class="st">"bill_length_mm"</span>,<span class="st">"bill_depth_mm"</span>,<span class="st">"flipper_length_mm"</span>,<span class="st">"body_mass_g"</span>],</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>            y<span class="op">=</span>[<span class="st">"body_mass_g"</span>,<span class="st">"bill_length_mm"</span>,<span class="st">"bill_depth_mm"</span>,<span class="st">"flipper_length_mm"</span>],</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>            hue<span class="op">=</span>[<span class="st">"species"</span>,<span class="st">"island"</span>,<span class="st">"sex"</span>],</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>            palette<span class="op">=</span>[<span class="st">"Set1"</span>,<span class="st">"Set2"</span>,<span class="st">"Dark2"</span>,<span class="st">"Paired2"</span>],</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>            size<span class="op">=</span>(<span class="dv">20</span>, <span class="dv">100</span>, <span class="dv">10</span>),</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>            color<span class="op">=</span>colorpicker)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Run the cell to update the widgets.</p>
<p>Finally, re-run the cell where we displayed the <code>interactive_scatterplot</code>. The plot should now have a title and you should see a new color picker below the slider for the point size. Try changing the title colour by clicking on the new color picker.</p>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Caution
</div>
</div>
<div class="callout-body-container callout-body">
<p>Note that you may have to close the colour picker once you’ve made your choice in order to make the plot update.</p>
</div>
</div>
</section>
<section id="other-interactive-plots" class="level2" data-number="9">
<h2 data-number="9" class="anchored" data-anchor-id="other-interactive-plots"><span class="header-section-number">9</span> Other interactive plots</h2>
<p>Jupyter widgets, like we used here, is the most vanilla way of getting interactive graphs in Jupyter notebooks. Some other alternatives are:</p>
<ul>
<li><a href="https://altair-viz.github.io/">altair</a> is a plotting library that uses Vega-Lite grammar which is reminiscent of ggplot2 in R. The syntax is different from what we’ve shown here, but it’s very powerful once you get the hang of it.</li>
<li><a href="https://plot.ly/python/ipython-notebook-tutorial">Plotly</a> is actually an API to a web service that renders your graph and returns it for display in your Jupyter notebook. Generates very visually appealing graphs, but from a reproducibility perspective it’s maybe not a good idea to be so reliant on a third party.</li>
<li><a href="https://bokeh.pydata.org/en/latest/docs/user_guide/notebook.html#userguide-notebook">Bokeh</a> is another popular tool for interactive graphs. Most plotting packages for Python are built on top of matplotlib, but Bokeh has its own library. This can give a steeper learning curve if you’re used to the standard packages.</li>
<li><a href="http://mpld3.github.io">mpld3</a> tries to integrate matplotlib with Javascript and the D3js package. It doesn’t scale well for very large datasets, but it’s easy to use and works quite seamlessly.</li>
</ul>
<div class="callout callout-style-default callout-note callout-titled" title="Quick recap">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Quick recap
</div>
</div>
<div class="callout-body-container callout-body">
<p>In this section we’ve learned:</p>
<ul>
<li>How to implement interactive widgets in notebooks</li>
</ul>
</div>
</div>
</section>
<section id="extensions" class="level2" data-number="10">
<h2 data-number="10" class="anchored" data-anchor-id="extensions"><span class="header-section-number">10</span> Extensions</h2>
<p>Jupyter Notebook extensions are add-ons that can increase the functionality of your notebooks. Extensions include themes, editors, git support, renderers and much more. The most user-friendly way of managing extensions is via the Extension Manager available in the Jupyter lab interface. You can access it by clicking the puzzle piece icon in the left sidebar.</p>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Caution
</div>
</div>
<div class="callout-body-container callout-body">
<p>Note that the extension manager contains a disclaimer warning you that these third-party extensions are not reviewed for vulnerabilities which means that you should be careful about what extensions you install.</p>
</div>
</div>
<p>You can use the search field to perform a free text search for available extensions, then click ‘Install’ to install an extension. Not that in some cases you will be prompted to install additional packages.</p>
<p>While an in-depth listing of available extensions is well beyond the scope of this tutorial we offer this list of a few extensions that are of particular relevance to this course:</p>
<ul>
<li><a href="https://github.com/jupyterlab/jupyterlab-github">Jupyterlab/GitHub</a> - view and open files from GitHub</li>
<li><a href="https://github.com/jupyterlab/jupyterlab-git">Jupyterlab/Git</a> - version controlling with git</li>
<li><a href="https://github.com/mamba-org/gator">mamba-org/gator-lab</a> - manage Conda environments</li>
<li><a href="https://github.com/voila-dashboards/voila">voila-dashboards/Jupyterlab-preview</a> - preview a rendered version of your notebook</li>
</ul>
<div class="callout callout-style-default callout-note callout-titled" title="Quick recap">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Quick recap
</div>
</div>
<div class="callout-body-container callout-body">
<p>In this section we’ve learned:</p>
<ul>
<li>What Jupyter extensions are and how to manage them</li>
</ul>
</div>
</div>
</section>
<section id="reproducibility" class="level2" data-number="11">
<h2 data-number="11" class="anchored" data-anchor-id="reproducibility"><span class="header-section-number">11</span> Reproducibility</h2>
<p>Now that you have a feeling for what Jupyter can do we’ll spend a little time on things to consider specifically from a repdroducibility point of view when it comes to Jupyter notebooks.</p>
</section>
<section id="version-control-of-jupyter-notebooks" class="level2" data-number="12">
<h2 data-number="12" class="anchored" data-anchor-id="version-control-of-jupyter-notebooks"><span class="header-section-number">12</span> Version control of Jupyter notebooks</h2>
<p>As we’ve seen, Jupyter notebooks are plain-text JSON files. This means that they can be version controlled with Git just like any other text file. However, because of the way Jupyter notebooks store their content, the diffs produced by Git can be difficult to interpret. Luckily, there are tools that can provide content-aware diffs and merge functionality for Jupyter notebooks.</p>
<p>One such tool is <a href="https://nbdime.readthedocs.io/en/latest/">nbdime</a>. <code>nbdime</code> is built to understand the structure of Jupyter notebooks and can therefore generate diffs that are easier to read. It can also be used to merge changes made to notebooks, which is great especially when collaborating on notebooks with others.</p>
<p><code>nbdime</code> is already installed in the <code>jupyter-env</code> Conda environment you are using for this tutorial. To try it in action, create a new notebook and name it <code>Analysis.ipynb</code>. Add the following code to the first cell, then run it:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>penguins <span class="op">=</span> sns.load_dataset(<span class="st">"penguins"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This simply imports some python modules and loads a dataset.</p>
<p>Save the notebook. Now we’ll add and commit the new notebook to the Git repository:</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> add Analysis.ipynb</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> commit <span class="at">-m</span> <span class="st">"Add Analysis notebook"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>So far so good. And nothing new here compared to what we’ve already learned about version control. Now let’s make some changes to the notebook. First we’ll replace one of the loaded modules. Update the first cell of the notebook so that it reads:</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>penguins <span class="op">=</span> sns.load_dataset(<span class="st">"penguins"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Then create a new cell where we’ll calculate the mean of each numeric value grouped by species. In the new cell, add the following code:</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>penguins.groupby(<span class="st">"species"</span>).mean(numeric_only<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Run the cell and save the notebook.</p>
<p>Now use <code>git diff</code> to view the changes we’ve made to the notebook. Run:</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> diff Analysis.ipynb</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Even with very minor modifications to the notebook the diff will contain numerous lines that are difficult to interpret. This is because the notebook not only contains the code, but also cell metadata and output (in this case a table produced by the second cell).</p>
<p>Now let’s generate a more easy-to-read diff. Run:</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="ex">nbdiff</span> <span class="at">-s</span> Analysis.ipynb</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This will use the <code>nbdiff</code> tool that comes with <code>nbdime</code> to show an inline diff of the notebook. The <code>-s</code> flag tells <code>nbdiff</code> to only show differences for the actual code changes, ignoring changes in metadata and output. There are a number of flags you can use here to customise the diff. The uppercase version of each flag will ignore the respective change type. For example, to see the diff but ignore changes to the output of cells you can run:</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="ex">nbdiff</span> <span class="at">-O</span> Analysis.ipynb</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>nbdime also comes with a graphical web-based diff viewer. To try it, run:</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="ex">nbdiff-web</span> Analysis.ipynb</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This will open up a tab in your web browser showing you changes made to the notebook side-by-side for each cell, including also cell output. This makes it easy to see changes made both to code and outputs such as tables and plots.</p>
<section id="other-tools-for-version-control-of-notebooks" class="level3" data-number="12.1">
<h3 data-number="12.1" class="anchored" data-anchor-id="other-tools-for-version-control-of-notebooks"><span class="header-section-number">12.1</span> Other tools for version control of notebooks</h3>
<ul>
<li>You can also install the nbdime jupyter <a href="https://github.com/jupyter/nbdime">lab extension</a> to get access to the diff functionality directly from the Jupyter lab interface. If you also install the <a href="https://github.com/jupyterlab/jupyterlab-git">jupyterlab-git</a> extension you can both view diffs and commit changes directly from Jupyter lab.</li>
<li><a href="https://code.visualstudio.com/">VS Code</a> actually comes with built-in support for both Jupyter notebooks and Git so that you can view <a href="https://code.visualstudio.com/docs/datascience/jupyter-notebooks#_custom-notebook-diffing">informative diffs</a> directly from the editor</li>
</ul>
</section>
</section>
<section id="making-sure-notebooks-work-as-expected" class="level2" data-number="13">
<h2 data-number="13" class="anchored" data-anchor-id="making-sure-notebooks-work-as-expected"><span class="header-section-number">13</span> Making sure notebooks work as expected</h2>
<p>One of the great things with Jupyter notebooks is the ability to do data exploration in an interactive way. Because loaded data, defined variables and functions remain in the notebook until you restart the kernel, you can easily make changes to your analysis and re-run cells to see the effect of the changes immediately. However, this can also be a source of errors and inconsistencies if you, during your work, modify or use variables in cells upstream of their initial definition.</p>
<p>The <code>nbval</code> package can help you catch these types of errors. <code>nbval</code> is a plugin for the <code>pytest</code> testing framework that can be used to test Jupyter notebooks. It works by executing each cell in the notebook and comparing the output to the output stored in the notebook. If the output is the same, the test passes. If the output differs, the test fails. <code>nbval</code> is also pre-installed in the <code>jupyter-env</code> Conda environment you’re using for this tutorial.</p>
<p>As an example, we’ll keep working with the <code>Analysis.ipynb</code> notebook we’ve created.</p>
<p>Let’s say we want to estimate the size of the bill of penguins using the <code>bill_length_mm</code> and <code>bill_depth_mm</code> columns. We’ll do this by adding a new cell to our notebook with the following code:</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>penguins[<span class="st">"bill_size"</span>] <span class="op">=</span> (penguins[<span class="st">"bill_length_mm"</span>] <span class="op">*</span> penguins[<span class="st">"bill_depth_mm"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Run the cell and add a new one below it. In the new cell, output the mean of each column grouped by <code>island</code> using the following code:</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>penguins.groupby(<span class="st">"island"</span>).mean(numeric_only<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Run the cell to see the output. Looks good. Now we have a very simple example of some exploratory analyses on a dataset.</p>
<p>Save the notebook and try running <code>nbval</code> on it to see if it works as expected. From the commandline, run:</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="ex">pytest</span> <span class="at">--nbval</span> Analysis.ipynb</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>nbval tests each cell in your notebook by executing it and comparing the output to the output stored in the notebook. If the output is the same, the test passes. The output of the test should look something like this:</p>
<pre><code>collected 4 items

Analysis.ipynb ....                                                                                                   [100%]

========== 4 passed in 1.93s ==========</code></pre>
<p>Now let’s say we realize that we want to normalize the <code>bill_size</code> values by the body mass of the penguins. We’ll just modify the cell where we calculated this value, introducing a small piece of code to divide by the <code>body_mass_g</code> column.</p>
<p>Change the third cell of the notebook so that it reads:</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>penguins[<span class="st">"bill_size"</span>] <span class="op">=</span> (penguins[<span class="st">"bill_length_mm"</span>] <span class="op">*</span> penguins[<span class="st">"bill_depth_mm"</span>]) <span class="op">/</span> penguins[<span class="st">"body_mass_g"</span>]</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>sns.scatterplot(data<span class="op">=</span>penguins, x<span class="op">=</span><span class="st">"bill_size"</span>, y<span class="op">=</span><span class="st">"flipper_length_mm"</span>, hue<span class="op">=</span><span class="st">"island"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Re-run the cell and save the notebook. So far so good! Let’s test the notebook again with nbval. Just like before run it from the commandline with:</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="ex">pytest</span> <span class="at">--nbval</span> Analysis.ipynb</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>If you’ve followed the instructions, this second run of nbval should generate a <code>FAILED</code> test, showing something like:</p>
<pre><code>==================== short test summary info ====================
FAILED Analysis.ipynb::Cell 3
================== 1 failed, 3 passed in 1.83s ==================</code></pre>
<p>What happened here was that we modified the cell where we calculated the <code>bill_size</code> value, but we didn’t re-run the cell where we output the mean of each column grouped by <code>island</code>. This means that the output of the last cell in the notebook now differs from what is actually stored in the notebook variables. This type of error can be difficult to spot, especially if you have a large notebook with many cells. Luckily, nbval can help us here.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Note that nbval reports cell numbers using 0-based numbering, so when the test fails on <code>Cell 3</code> it actually refers to the 4th cell in the notebook.</p>
</div>
</div>
<p>This problem could have been solved if we had re-run the cell where we output the mean of each column grouped by <code>island</code>. In fact, it is good practice to re-run all cells in a notebook before saving it. If you in addition restart the kernel before re-running you make sure that you haven’t introduced any ‘hidden states’</p>
<div class="callout callout-style-default callout-tip callout-titled" title="Ignoring specific cells">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Ignoring specific cells
</div>
</div>
<div class="callout-body-container callout-body">
<p>One caveat of <code>nbval</code> is that it doesn’t work well with cells that generate plots. You can tell <code>nbval</code> to ignore the output of specific cells by adding <code># NBVAL_IGNORE_OUTPUT</code> to the top of a cell.</p>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled" title="Quick recap">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Quick recap
</div>
</div>
<div class="callout-body-container callout-body">
<p>In this section we’ve learned: - How to use <code>nbdime</code> to view diffs of Jupyter notebooks - How to use <code>nbval</code> to test that notebooks work as expected</p>
</div>
</div>
</section>
<section id="converting-notebooks" class="level2" data-number="14">
<h2 data-number="14" class="anchored" data-anchor-id="converting-notebooks"><span class="header-section-number">14</span> Converting notebooks</h2>
<p>Notebooks can be converted to various output formats such as HTML, PDF, LaTeX <em>etc.</em> directly from the <strong>File</strong> -&gt; <strong>Save and Export Notebook As…</strong> menu.</p>
<p>Conversion can also be performed on the command line using the <code>jupyter nbconvert</code> command. <code>nbconvert</code> is installed together with the <code>jupyter</code> Conda package and is executed on the command line by running <code>jupyter nbconvert</code>.</p>
<p>The syntax for converting a Jupyter notebook is:</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="ex">jupyter</span> nbconvert <span class="at">--to</span> <span class="op">&lt;</span>FORMAT<span class="op">&gt;</span> notebook.ipynb</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Here <code>&lt;FORMAT&gt;</code> can be any of <code>asciidoc</code>, <code>custom</code>, <code>html</code>, <code>latex</code>, <code>markdown</code>, <code>notebook</code>, <code>pdf</code>, <code>python</code>, <code>rst</code>, <code>script</code>, <code>slides</code>. Converting to some output formats (<em>e.g.</em> PDF) may require you to install separate software such as <a href="https://pandoc.org/">Pandoc</a> or a <strong>TeX</strong> environment.</p>
<p>Try converting the <code>jupyter-tutorial.ipynb</code> notebook that you have been working on for this tutorial to HTML using <code>jupyter nbconvert</code>.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>If the plots in HTML rendered version of your notebook are not displayed properly, try changing the <code>matplotlib_inline.backend_inline.set_matplotlib_formats('pdf', 'svg')</code> line to <code>matplotlib_inline.backend_inline.set_matplotlib_formats('retina')</code>.</p>
</div>
</div>
<p><code>nbconvert</code> can also be used to run a Jupyter notebook from the command line by running:</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="ex">jupyter</span> nbconvert <span class="at">--execute</span> <span class="at">--to</span> <span class="op">&lt;</span>FORMAT<span class="op">&gt;</span> notebook.ipynb</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><code>nbconvert</code> executes the cells in a notebook, captures the output and saves the results in a new file. Try running it on the <code>jupyter-tutorial.ipynb</code> notebook.</p>
<p>You can also specify a different output file with <code>--output &lt;filename&gt;</code>.</p>
<p>So in order to execute your <code>jupyter-tutorial.ipynb</code> notebook and save it to a file named <code>report.html</code> you could run:</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="ex">jupyter</span> nbconvert <span class="at">--to</span> html <span class="at">--output</span> report.html <span class="at">--execute</span> jupyter-tutorial.ipynb</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="callout callout-style-default callout-note callout-titled" title="Quick recap">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Quick recap
</div>
</div>
<div class="callout-body-container callout-body">
<p>In this section we’ve learned:</p>
<ul>
<li>How to convert Jupyter notebooks to various other formats</li>
<li>How to use <code>nbconvert</code> to convert notebooks on the command line</li>
</ul>
</div>
</div>
</section>
<section id="notebooks-and-quarto" class="level2" data-number="15">
<h2 data-number="15" class="anchored" data-anchor-id="notebooks-and-quarto"><span class="header-section-number">15</span> Notebooks and Quarto</h2>
<p>You may have noticed that a lot of the functionality in Jupyter is overlapping with Quarto. And you may be wondering which one to use. This is a difficult question to answer as it will depend on your use-case and personal preference. As such, any answer will be subjective, but we’ll try to give you some pointers on how to get the best out of both worlds.</p>
<p>While similar in some ways Jupyter and Quarto are not completely overlapping. Quarto is great for generating high-quality reports and manuscripts, and is agnostic to the programming language used. Jupyter on the other hand is great for interactive data analysis and exploration with a more direct connection between code and output. While Jupyter is also somewhat agnostic to programming language, it is most commonly used with Python and with both the Jupyter and Python ecosystem at its back it can be customized with a lot of different extensions and plugins.</p>
<p>The good news is that the two can be used together allowing you to get the best of both. For example, you may like the professional look of rendered Quarto documents but really like the interactive and exploratory nature of Jupyter. Well you can simply work as you normally do in Jupyter and then use Quarto to render the notebook to a high-quality report or manuscript.</p>
<p>To give you an example, take a look at the <code>supplementary_material.ipynb</code> file in the <code>jupyter/</code> tutorial directory. Open this notebook in the Jupyter lab interface (make sure you have activated the <code>jupyter-env</code> Conda environment).</p>
<p>As you can see this notebook contains some brief descriptions in Markdown and code to generate a few plots. It uses the output from the MRSA case-study Snakemake workflow you worked on in the Snakemake tutorial. This is a common use-case for Jupyter notebooks; to generate summary statistics and plots from the results of a workflow run. (A real-world example could of course include a lot more in-depth exploratory analyses).</p>
<p>Now, let’s say you want to share the results of this notebook with your PI or collaborators. We could simply share the notebook file, or as we saw in the previous section, convert it to HTML or PDF via <code>jupybter nbconvert</code>.</p>
<p>Let’s do that first so we have something to compare with. Run the following:</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="ex">jupyter</span> nbconvert <span class="at">--to</span> HTML <span class="at">--output</span> supplementary_material.nbconvert.html supplementary_material.ipynb</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Open the <code>supplementary_material.nbconvert.html</code> file in a browser to see that it looks like you expect. This looks more or less like the original notebook.</p>
<p>Now let’s go one step further and render the notebook to a high-quality report using Quarto. We can actually add a YAML header to the notebook with some document options that Quarto understands. Create a new cell in the notebook (from the Jupyter lab interface) and move it to the top. In this cell, add the following:</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="pp">---</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span><span class="kw">:</span><span class="at"> Supplementary material</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a><span class="fu">subtitle</span><span class="kw">:</span><span class="at"> Supplementary tables and plots for the MRSA study</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a><span class="fu">format</span><span class="kw">:</span></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">html</span><span class="kw">:</span></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">embed-resources</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">code-fold</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">code-tools</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a><span class="fu">language</span><span class="kw">:</span></span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">code-summary</span><span class="kw">:</span><span class="at"> Click to show code</span></span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a><span class="fu">bibliography</span><span class="kw">:</span><span class="at"> references.bib</span></span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a><span class="pp">---</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Set the cell type to <code>Markdown</code>, then run the cell. Most likely that cell will look rather weird but that’s OK. We’ll fix that in a bit.</p>
<p>Save the notebook and now render the document with Quarto from the commandline:</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="ex">quarto</span> render supplementary_material.ipynb</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Open up the <code>supplementary_material.html</code> file in a browser and compare it to the <code>supplementary_material.nbconvert.html</code> file. You should see that the Quarto version looks a lot better. The fact that Quarto supports rendering of Jupyter notebooks means you can keep editing your notebooks as you normally would and use Quarto for rendering the final document. Also there’s very little we had to change in the notebook to make it work with Quarto. If you look closely at the code cells used to generate the plots and table you’ll see that they contain code-chunk options in the same form we used in the Quarto tutorial. These options do not impact the notebook when run in Jupyter, making it easy to use the two tools in combination.</p>
<p>Let’s go back to the YAML header cell and fix how it looks in the Jupyter notebook. The reason it looks weird is that Jupyter doesn’t understand the syntax. But luckily there’s a Jupyter lab Quarto extension you can install to fix this. Click the extension icon in the left sidebar and search for <code>quarto</code>. Install the <code>jupyterlab-quarto</code> extension and then reload the page. Now the YAML header should look a lot better.</p>
<p>Try adding more options to the header to customize the look of the rendered document. For instance you could:</p>
<ul>
<li>add a Table of contents with (<code>toc: true</code>)</li>
<li>try out different <a href="https://quarto.org/docs/output-formats/html-themes.html">themes</a></li>
<li>add your name as author (<code>author: Your Name</code>)</li>
<li>add a date (<code>date: last-modified</code>)</li>
</ul>
<p>and much more.</p>
<div class="callout callout-style-default callout-note callout-titled" title="Quick recap">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Quick recap
</div>
</div>
<div class="callout-body-container callout-body">
<p>In this section we’ve learned:</p>
<ul>
<li>How to use Quarto to render Jupyter notebooks to high-quality reports.</li>
</ul>
</div>
</div>
</section>
<section id="extra-material" class="level2" data-number="16">
<h2 data-number="16" class="anchored" data-anchor-id="extra-material"><span class="header-section-number">16</span> Extra material</h2>
<p>The following material contains some additional tips and tricks on how to use Jupyter notebooks. This is not part of the core of the Jupyter material and you can choose what you want to go through, or skip it entirely.</p>
<p>Here are some useful resources if you want to read more about Jupyter in general:</p>
<ul>
<li>The <a href="http://jupyter.org">Jupyter project site</a> contains a lot of information and inspiration.</li>
<li>The <a href="https://jupyter-notebook.readthedocs.io/en/stable/">Jupyter Notebook documentation</a>.</li>
<li>A <a href="http://ipywidgets.readthedocs.io/en/stable/index.html">guide</a> to using widgets for creating interactive notebooks.</li>
</ul>
</section>
<section id="running-jupyter-notebooks-on-a-cluster" class="level2" data-number="17">
<h2 data-number="17" class="anchored" data-anchor-id="running-jupyter-notebooks-on-a-cluster"><span class="header-section-number">17</span> Running Jupyter notebooks on a cluster</h2>
<ul>
<li>Login to Uppmax, making sure to use a specific login node, <em>e.g.</em> <code>rackham1</code>:</li>
</ul>
<pre><code>ssh &lt;your-user-name&gt;@rackham1.uppmax.uu.se</code></pre>
<ul>
<li>Create/activate a Conda environment containing <code>jupyter</code>, <em>e.g.</em>:</li>
</ul>
<pre><code>conda create -n jupyter -c conda-forge jupyter</code></pre>
<ul>
<li>activate the environment, then run:</li>
</ul>
<pre><code>jupyter notebook --no-browser</code></pre>
<p>When the Jupyter server starts up you should see something resembling:</p>
<pre><code>[I 2023-11-13 22:15:36.944 ServerApp] Serving notebooks from local directory: &lt;path-to-your-directory&gt;
[I 2023-11-13 22:15:36.944 ServerApp] Jupyter Server 2.10.0 is running at:
[I 2023-11-13 22:15:36.944 ServerApp] http://localhost:8888/tree?token=25fa07e89b7c0bc2e518f259ba79c67847ca813cdf4eeed6
[I 2023-11-13 22:15:36.944 ServerApp]     http://127.0.0.1:8888/tree?token=25fa07e89b7c0bc2e518f259ba79c67847ca813cdf4eeed6
[I 2023-11-13 22:15:36.944 ServerApp] Use Control-C to stop this server and shut down all kernels (twice to skip confirmation).</code></pre>
<p>Now a Jupyter notebook server is running on the Uppmax end. The line that says:</p>
<pre><code>[I 2023-11-13 22:15:36.944 ServerApp] http://localhost:8888/tree?token=25fa07e89b7c0bc2e518f259ba79c67847ca813cdf4eeed6</code></pre>
<p>Contains information on the port used on the server side (8888 in this case) and the token required to use the server (<code>25fa07e89b7c0bc2e518f259ba79c67847ca813cdf4eeed6</code>).</p>
<p>Next step is to use this information to login to the server from your local computer.</p>
<p><strong>On your local computer</strong></p>
<p>In a terminal, run the following command to start port forwarding of port 8080 on your local computer to the remote port on the Uppmax side. Replace <remote-port> with the port given when you started the server on Uppmax. Also replace <your-user-name> with your user name on Uppmax.</your-user-name></remote-port></p>
<div class="sourceCode" id="cb56"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ssh</span> <span class="at">-N</span> <span class="at">-L</span> localhost:8080:localhost:<span class="op">&lt;</span>remote-port<span class="op">&gt;</span> <span class="op">&lt;</span>your-user-name<span class="op">&gt;</span>@rackham1.uppmax.uu.se</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>As long as this process is running the port forwarding is running. To disable it simply interrupt it with <code>CTRL + C</code>.</p>
<p>Connect to the Jupyter server by opening <code>localhost:8080</code> in your browser. When prompted, paste the token you got when starting the server on Uppmax and set a new password.</p>
</section>
<section id="using-binder-to-share-interactive-notebooks" class="level2" data-number="18">
<h2 data-number="18" class="anchored" data-anchor-id="using-binder-to-share-interactive-notebooks"><span class="header-section-number">18</span> Using Binder to share interactive notebooks</h2>
<p><a href="https://mybinder.org/">Binder</a> is a service that allows you to share Jupyter notebooks with others, while also allowing them to run the notebooks in the browser. This is great if you wish to share an analysis and have others interact with the code and results, without them having to install anything locally. What you will need is:</p>
<ol type="1">
<li>A public GitHub repository containing the notebooks you want to share.</li>
<li>An <code>environment.yml</code> file in the repository containing the Conda environment required to run the notebooks.</li>
<li>Data files (if any) required to run the notebook(s).</li>
</ol>
<p>Binder will then create a Docker image containing the Conda environment and the notebooks, and run a Jupyter server on this image. The Docker image is then hosted on the Binder server and can be used by anyone with the link to the repository to run the notebooks interactively in their browser.</p>
<p>To show you an example we’ve created a basic <a href="https://github.com/NBISweden/workshop-reproducible-research-binder_example">GitHub repository</a> containing the <code>supplementary_material.ipynb</code> notebook from the previous section. If you go to the repository you will see a badge saying “launch binder”, click this to start the Binder server. This will take a few minutes the first time you do it, but after that it should be faster. When the server is ready you will be presented with the now familiar Jupyter interface. Go ahead and open up the <code>supplementary_material.ipynb</code> notebook and run it.</p>
<p>You can now interact with the notebook as you would if you had it running on a local Jupyter server. You can change the code, run it, and see the results. You can also add new cells and write new code. However, you cannot save the changes you make to the notebook.</p>
<p>To read more about Binder and how to use it, see the <a href="https://mybinder.readthedocs.io/en/latest/">Binder documentation</a>. For pointers on how to make data available to the notebooks you share via Binder, see this guide on <a href="https://the-turing-way.netlify.app/communication/binder/zero-to-binder.html#accessing-data-in-your-binder">Accessing data in your Binder</a>.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>2024 <a href="https://nbis.se">NBIS</a> | <a href="https://choosealicense.com/licenses/gpl-3.0/">GPL-3 License</a></p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
<p>Published with <a href="https://quarto.org/">Quarto</a> v1.4.549
</p>
</div>
  </div>
</footer>




<script src="../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>